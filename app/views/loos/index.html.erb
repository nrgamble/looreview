<h1>Gotta Go!</h1>

<style>
#map {
  width: 500px;
  height: 500px;
}
</style>

<div id="map"></div>

<script>
  var map;
  function initMap() {
    map = new google.maps.Map(document.getElementById('map'), {
      center: { lat: 38.702934, lng: -9.178818 },
      zoom: 15
    });

    var infowindow = new google.maps.InfoWindow();
    <% @loos.each do |loo| %>
      var marker = new google.maps.Marker({
        position: { lat: <%= loo.lat %>, lng: <%= loo.long %> },
        map: map,
        title: '<%= loo.name %>'
      });
      var content = '<%= render 'map_info', loo: loo %>';
      google.maps.event.addListener(marker, 'click', (function(marker, content, infowindow) {
        return function() {
          infowindow.close();
          infowindow.setContent(content);
          infowindow.open(map, marker);
        };
      })(marker, content, infowindow)); 
    <% end %>
  }
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCcA3HXjEXDRQHMNfzpMFI88h2SOE0Ez7A&callback=initMap" async defer></script>
